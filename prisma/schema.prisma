// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

// Note that some adapters may set a maximum length for the String type by default, please ensure your strings are long
// enough when changing adapters.
// See https://www.prisma.io/docs/orm/reference/prisma-schema-reference#string for more information
datasource db {
  provider = "sqlite"
  url      = "file:dev.sqlite"
}

model Session {
  id            String    @id
  shop          String
  state         String
  isOnline      Boolean   @default(false)
  scope         String?
  expires       DateTime?
  accessToken   String
  userId        BigInt?
  firstName     String?
  lastName      String?
  email         String?
  accountOwner  Boolean   @default(false)
  locale        String?
  collaborator  Boolean?  @default(false)
  emailVerified Boolean?  @default(false)
}


model Region {
  id         Int      @id @default(autoincrement())
  name       String
  code       String
  commune_id Int?
  isActive   Boolean  @default(true)
  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
  communes   Commune[]

  @@map("regions")
}

model Commune {
  id        Int    @id @default(autoincrement())
  name      String
  isActive   Boolean  @default(true)
  region_id Int
  tax_id    Int
  region    Region @relation(fields: [region_id], references: [id])
  tax       Tax    @relation(fields: [tax_id], references: [id])

  @@map("communes")
}

model Tax {
  id              Int           @id @default(autoincrement())
  name            String
  value           Float
  description     String
  isActive        Boolean       @default(true)
  createdAt       DateTime      @default(now())
  updatedAt       DateTime      @updatedAt
  communes        Commune[]

  @@map("taxes")
}

model LogisticCenter {
  id                  Int       @id @default(autoincrement())
  externalId          Int       @map("external_id")
  accessToken         String?   @map("access_token")
  baseUrl             String?   @map("base_url")
  name                String
  address             String
  detail              String?
  responsable         String
  email               String
  phone               String
  active              Boolean   @default(true)
  communeId           Int       @map("commune_id")
  shop                String
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")

  @@unique([externalId, shop])
  @@map("logistic_centers")
}

model AuditLog {
  id                  Int       @id @default(autoincrement())
  shopifyOrderId      String    @map("shopify_order_id")
  orderName           String?   @map("order_name")
  shop                String
  eventType           String    @map("event_type") // "order_paid", "package_created", "shipment_completed", "error"
  status              String    // "success", "error", "pending", "retry"
  requestData         String?   @map("request_data") // JSON string
  responseData        String?   @map("response_data") // JSON string
  errorMessage        String?   @map("error_message")
  httpStatus          Int?      @map("http_status")
  retryCount          Int       @default(0) @map("retry_count")
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")

  @@index([shopifyOrderId])
  @@index([shop])
  @@index([eventType])
  @@index([createdAt])
  @@map("audit_logs")
}

